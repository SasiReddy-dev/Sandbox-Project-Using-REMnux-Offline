<!DOCTYPE html>
<html>
  <head>
    <title>Sandbox-Based File Analysis System</title>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f2f4f8;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }

      h1 {
        color: #1e2a78;
        font-size: 30px;
        margin-bottom: 40px;
      }

      form {
        background: #fff;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      input[type="file"] {
        margin-bottom: 20px;
        font-size: 15px;
      }

      .btn {
        background-color: #1e2a78;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        margin: 0 8px;
      }

      .btn:hover {
        background-color: #2a3fba;
      }

      .btn-secondary {
        background-color: #555;
      }

      .btn-secondary:hover {
        background-color: #666;
      }

      .btn-row {
        margin-top: 10px;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <h1>Sandbox-Based File Analysis System</h1>

    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="file" required /><br />

      <div class="btn-row">
        <button id="analyzeBtn" class="btn" type="submit">Analyze File</button>
        <button id="dynBtn" class="btn btn-secondary" type="button">Run Dynamic (Simulate)</button>
      </div>
    </form>

    <script>
const form = document.getElementById("uploadForm");
const dynBtn = document.getElementById("dynBtn");

// --- Static analysis ---
form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    try {
        const res = await fetch("/upload", { method: "POST", body: formData });
        if (!res.ok) throw new Error("Server error");
        const data = await res.json();

        // Save static report + excel path
        localStorage.setItem("analysisReport", JSON.stringify(data.report));
        localStorage.setItem("excelPath", data.excel_path || "");

        // Clear any previous dynamic log (optional)
        localStorage.removeItem("dynamicLog");

        window.location.href = "/report";
    } catch (err) {
        alert("Error during static analysis: " + err.message);
    }
});

// --- Dynamic simulation ---
dynBtn.addEventListener("click", async () => {
    const fileInput = form.querySelector('input[type="file"]');
    if (!fileInput.files.length) {
        alert("Please choose a file first.");
        return;
    }
    const fd = new FormData();
    fd.append("file", fileInput.files[0]);

    try {
        const res = await fetch("/dynamic_simulate", { method: "POST", body: fd });
        if (!res.ok) {
            const txt = await res.text().catch(()=>null);
            throw new Error(txt || "Server error");
        }
        const data = await res.json();

        // Save only dynamic log
        localStorage.setItem("dynamicLog", JSON.stringify(data.dynamic_log || {}));

        // Clear previous static report to avoid confusion
        localStorage.removeItem("analysisReport");
        localStorage.removeItem("excelPath");

        window.location.href = "/report";
    } catch (err) {
        alert("Error during dynamic simulation: " + err.message);
    }
});
</script>

  </body>
</html>
